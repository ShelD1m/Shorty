<!doctype html>
<html lang="ру">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Shorty · Статистика</title>
    <link rel="stylesheet" href="assets/css/styles.css"/>
</head>
<body>
<div class="container">
    <div class="h">
        <h1>Статистика ссылки</h1>
        <a href="dashboard.html" class="btn secondary">Назад</a>
    </div>
    <div class="card" id="info"></div>
    <div class="card" style="margin-top:16px;">
        <canvas id="chart" width="800" height="300" style="width:100%;"></canvas>
        <p class="notice">Когда реализуешь /api/links/{id}/stats, график покажет клики по дням.</p>
    </div>
</div>
<script src="assets/js/api.js"></script>
<script src="assets/js/ui.js"></script>
<script>
    if (!API.token) location.href = 'index.html';
    const url = new URL(location.href); const id = url.searchParams.get('id'); const slug = url.searchParams.get('slug');
    async function load(){
        try {
            const l = await API.links.get(id);
            qs('#info').innerHTML = '<div class="row"><div><div class="label">Slug</div><div class="kbd">'+l.slug+'</div></div>' +
                '<div><div class="label">Target</div><div>'+l.targetUrl+'</div></div>'+
                '<div><div class="label">Короткая ссылка</div><div><a target="_blank" href="'+API.base+l.shortUrl+'">'+l.shortUrl+'</a></div></div></div>';
        } catch(e){ qs('#info').innerHTML = '<span class="notice">Ошибка загрузки: '+e.message+'</span>'; }
    }
    function drawDemoChart(){
        const ctx = document.getElementById('chart').getContext('2d');
        const w = ctx.canvas.width, h = ctx.canvas.height;
        ctx.clearRect(0,0,w,h);
        const data = [3,5,1,7,4,9,6,2,8,5,4,10]; // demo
        const max = Math.max(...data)+1;
        const barW = Math.floor((w-60)/data.length);
        ctx.strokeStyle = '#2f3a55'; ctx.beginPath(); ctx.moveTo(40,10); ctx.lineTo(40,h-30); ctx.lineTo(w-10,h-30); ctx.stroke();
        data.forEach((v,i)=>{
            const x = 40 + i*barW + 6, y = (h-30) - Math.round((v/max)*(h-60)), bh = (h-30)-y;
            ctx.fillStyle = '#22c55e'; ctx.fillRect(x,y,barW-12,bh);
        });
        ctx.fillStyle = '#a3a3a3'; ctx.font = '12px ui-monospace';
        ctx.fillText('демо-данные', w-110, 20);
    }
    load(); drawDemoChart();
</script>
</body>
</html>
